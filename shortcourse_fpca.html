<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Functional PCA</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.9.0/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-1.46.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotly-main-1.46.1/plotly-latest.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">JSM 2019</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Short Course
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="shortcourse_data.html">Data and Code</a>
    </li>
    <li>
      <a href="shortcourse_wearables_overview.html">Wearables: overview</a>
    </li>
    <li>
      <a href="shortcourse_notation.html">Notation</a>
    </li>
    <li>
      <a href="shortcourse_fpca.html">Functional PCA</a>
    </li>
    <li>
      <a href="shortcourse_sofr.html">Scalar-on-Function Regression</a>
    </li>
    <li>
      <a href="shortcourse_fosr.html">Function-on-Scalar Regression</a>
    </li>
    <li>
      <a href="shortcourse_other_functional_approaches.html">Other Functional Approaches</a>
    </li>
    <li>
      <a href="shortcourse_wearables_non-functional_approaches.html">Wearables: Non-Functional methods</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="http://github.com/jeff-goldsmith/JSM">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Functional PCA</h1>

</div>


<p>This page contains a combination of traditional lecture materials (slides) and code demonstrating the relevant methods. The short course will proceed by working through both. We will use several recent packages in our examples; see the <a href="./About.html">About</a> page for information about the package versions.</p>
<pre class="r"><code>library(tidyverse)
## Registered S3 methods overwritten by &#39;ggplot2&#39;:
##   method         from 
##   [.quosures     rlang
##   c.quosures     rlang
##   print.quosures rlang
## ── Attaching packages ─────────────────────────────────────────────────────────── tidyverse 1.2.1 ──
## ✔ ggplot2 3.1.1     ✔ purrr   0.3.2
## ✔ tibble  2.1.2     ✔ dplyr   0.8.1
## ✔ tidyr   0.8.3     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.4.0
## ── Conflicts ────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
library(grpreg)
## 
## Attaching package: &#39;grpreg&#39;
## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select
library(splines)
library(refund)
library(refund.shiny)
library(reshape2)
## 
## Attaching package: &#39;reshape2&#39;
## The following object is masked from &#39;package:tidyr&#39;:
## 
##     smiths
library(plotly)
## 
## Attaching package: &#39;plotly&#39;
## The following object is masked from &#39;package:grpreg&#39;:
## 
##     select
## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     last_plot
## The following object is masked from &#39;package:stats&#39;:
## 
##     filter
## The following object is masked from &#39;package:graphics&#39;:
## 
##     layout</code></pre>
<p>In this section, we will use the <a href="./shortcourse_data.html">NHANES_JSM_2019</a> data to illustrate scalar on function regression (sofr).</p>
<div id="nhanes-data" class="section level2">
<h2>NHANES data</h2>
<p>The participant-specific daily activity profiles have been created by i) log-transforming minute level counts per minute, ii) calculating hourly total activity count (hTAC), iii) averaging the hTAC over all available days. Thus, a participant-specific daily activity profile is represented by 24 points.</p>
<p>First, we to plot all participant-specific daily activity profiles:</p>
<p><span class="math display">\[x_i(t), t = 1,\ldots, 24\]</span></p>
<pre class="r"><code>#load(&quot;./DataCode/JSM_2019_NHANES.RDA&quot;)
load(&quot;./DataCode/NHANES_JSM_2019.RData&quot;)

hTAC = as.matrix(hTAC)
n = dim(hTAC)[1] # number of participants
col.light = rgb(0, 0, 0, alpha = 8, maxColorValue = 255)
x.range = 1:24

## plot all profiles 
plot(x.range, hTAC[1,], type = &quot;n&quot;, ylim = range(hTAC), xaxt = &quot;n&quot;, ylab = &quot;Log of Activity Counts&quot;, xlab = &quot;Hour&quot;, col = col.light, main = &quot;Diurnal Profiles&quot;)
for(i in 2:n) lines(1:24, hTAC[i,], col = col.light, type = &quot;l&quot;, lwd = 1)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects-1.png" width="768" /></p>
</div>
<div id="marginal-information" class="section level2">
<h2>Marginal information</h2>
<p>One way to look at the marginal information is by looking at <strong>marginal hour-specific means and standard deviations</strong>. Below, we add the mean curve and plus/minus 1.96 times standard deviations curves</p>
<pre class="r"><code>hTAC.mean &lt;- apply(hTAC, 2, mean)
hTAC.sd &lt;- apply(hTAC, 2, sd)

## plot all profiles 
plot(x.range, hTAC[1,], type = &quot;n&quot;, ylim = range(hTAC), xaxt = &quot;n&quot;, ylab = &quot;Log of Activity Counts&quot;, xlab = &quot;Hour&quot;, col = col.light, main = &quot;Diurnal Profiles&quot;)
for(i in 2:n) lines(x.range, hTAC[i,], col = col.light, type = &quot;l&quot;, lwd = 1)
lines(x.range, hTAC.mean, col = &quot;blue&quot;, type = &quot;l&quot;, lwd = 2)
lines(x.range, hTAC.mean + 1.96*hTAC.sd, col = &quot;blue&quot;, type = &quot;l&quot;, lty = &quot;dashed&quot;, lwd = 2)
lines(x.range, hTAC.mean - 1.96*hTAC.sd, col = &quot;blue&quot;, type = &quot;l&quot;, lty = &quot;dashed&quot;, lwd = 2)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_01-1.png" width="768" /></p>
<div id="sample-summaries" class="section level3">
<h3>Sample summaries</h3>
<p>We can calculate <strong>hour-specific sample mean</strong> as</p>
<p><span class="math display">\[\bar{x}(t)= \frac{1}{n}\sum_{i=1}^n x_i(t)\]</span></p>
<p>the <strong>hour-specific sample variance</strong> as</p>
<p><span class="math display">\[\widehat{Var}(x(t)) = \frac{1}{n}\sum_{i=1}^n (x_i(t)-\bar{x}(t))^2\]</span></p>
<p>and the <strong>total sample variation</strong> as</p>
<p><span class="math display">\[\sum_{t=1}^T \widehat{Var}(x(t)) = \frac{1}{n}\sum_{t=1}^T 
  \sum_{i=1}^n (x_i(t)-\bar{x}(t))^2\]</span></p>
<blockquote>
<p>PCA treats the total variation as total information</p>
</blockquote>
</div>
<div id="sample-covariance-and-correlation-matrixes" class="section level3">
<h3>Sample covariance and correlation matrixes</h3>
<p><strong>Sample covariance matrix</strong> is defined as</p>
<p><span class="math display">\[\hat{\Sigma}(t,s) = \widehat{Cov}(x(t), x(s)) = \frac{1}{n}\sum_{i=1}^n (x_i(t)-\bar{x}(t))(x_i(s)-\bar{x}(s)), \quad s,t = 1,\ldots, 24\]</span></p>
<pre class="r"><code>  ## plot the covariance surface
  hTAC.cov = cov(hTAC)
  plot_ly(z = ~hTAC.cov) %&gt;% add_surface()</code></pre>
<p><div id="htmlwidget-e33b41b2d89ed0aaa7bb" style="width:768px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-e33b41b2d89ed0aaa7bb">{"x":{"visdat":{"429f250a926d":["function () ","plotlyVisDat"]},"cur_data":"429f250a926d","attrs":{"429f250a926d":{"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"zaxis":{"title":"hTAC.cov"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"colorbar":{"title":"hTAC.cov","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"z":[[1195.23899278968,826.855918706608,637.470450568347,519.033250925866,461.345849581271,321.40697938591,53.0223277712679,-295.820970074508,-564.778424809132,-658.687884646166,-597.920845748993,-503.068862476114,-335.342799046346,-248.973469140394,-205.657290099726,-125.772108899024,-61.5650061226059,-9.91346109897285,139.272229507424,384.43130011651,578.359222671485,834.15496101861,1135.21654088944,1244.55265597734],[826.855918706608,793.110441547233,644.049067945788,537.878781109086,504.959006658242,418.575792555542,234.449568432976,-66.9857693517636,-315.141084506166,-438.729342568063,-458.307020432211,-429.041489008175,-319.596948721869,-261.726759284937,-241.194859226093,-186.486108563557,-139.417559487269,-100.45058928779,-17.4656503199407,141.776208084321,257.669452327802,453.695062448052,689.90141561801,798.987160993346],[637.470450568347,644.049067945788,687.707331249731,588.38981927616,562.135138653343,498.30930135023,356.782087827833,79.5835145191651,-151.630641600698,-302.070147127818,-355.311856427348,-372.274254432531,-292.196363472307,-274.138646254527,-260.66386647577,-239.219537524325,-198.03249981036,-173.337202122357,-126.191862075402,-3.22369565213421,100.163125378455,261.382308859574,470.756993396256,586.608324137768],[519.033250925866,537.878781109086,588.38981927616,778.045340917964,808.079834613756,715.095967537316,544.929696124138,252.248412526244,19.4489264430591,-168.397035759255,-255.480855284174,-273.786410782708,-214.211028375725,-239.810803300072,-218.590074354257,-214.501852787873,-182.437915251042,-197.929140119623,-168.586184012878,-60.8076009425842,15.8674656704618,145.91201763484,322.544762217753,446.574179325641],[461.345849581271,504.959006658242,562.135138653343,808.079834613756,1303.12579797397,1365.30775606689,1185.81487312109,793.4719045394,427.943303911516,136.588005050243,-16.2702411832965,-105.70222225177,-64.0283399925406,-117.676869615405,-121.617694884786,-158.448389927914,-148.24035631006,-210.55428388906,-230.174864960364,-159.238474118646,-136.742235045583,-28.533540643028,171.258552926276,342.721417978041],[321.40697938591,418.575792555542,498.30930135023,715.095967537316,1365.30775606689,2702.25458557089,2805.81658462017,2140.37142616977,1394.38265073615,820.225415320927,535.240779415197,270.993911145689,258.674067299379,194.514191496274,188.662161479573,120.188097788925,29.9620282848025,-85.6205235477422,-231.481460797347,-282.083136399519,-365.270969596558,-342.396480466606,-155.798350673464,89.8401162195018],[53.0223277712679,234.449568432976,356.782087827833,544.929696124138,1185.81487312109,2805.81658462017,5456.35277711696,4897.18225860135,3433.50967146881,2258.07393845128,1629.18680875419,1085.3804208479,852.074791454151,782.372932000561,723.314629588567,705.764051242458,504.168719951406,197.615324297492,-103.130515554242,-372.776523389267,-553.622738266748,-680.767379235463,-606.031261985776,-342.425252171974],[-295.820970074508,-66.9857693517636,79.5835145191651,252.248412526244,793.4719045394,2140.37142616977,4897.18225860135,7584.96973185675,6002.40939848278,4087.17726183471,2989.49612883961,2234.78728933762,1647.13766664707,1490.23840320001,1319.00427125767,1344.53555111919,1129.59620144124,714.828922600904,162.510958882952,-355.514226583812,-669.039291716841,-995.386356785675,-1113.8843448676,-835.76198968542],[-564.778424809132,-315.141084506166,-151.630641600698,19.4489264430591,427.943303911516,1394.38265073615,3433.50967146881,6002.40939848278,7563.10041342627,5516.07413864105,4090.3848437715,3109.78380362321,2255.37156123191,2052.06966874198,1771.44752945008,1756.8602576815,1530.84685377093,1136.47246050357,518.307974950514,-199.781863486271,-640.254454637172,-1056.21323757295,-1277.00999606585,-1089.93245004748],[-658.687884646166,-438.729342568063,-302.070147127818,-168.397035759255,136.588005050243,820.225415320927,2258.07393845128,4087.17726183471,5516.07413864105,6356.56891835999,4778.66576996758,3658.41176981399,2676.14819149957,2406.26462502793,2112.77877038649,2031.53384871444,1744.37101436469,1331.64486281168,823.251845832587,125.553303833446,-400.207690796142,-867.340769931355,-1178.70105343522,-1109.66886402973],[-597.920845748993,-458.307020432211,-355.311856427348,-255.480855284174,-16.2702411832965,535.240779415197,1629.18680875419,2989.49612883961,4090.3848437715,4778.66576996758,5367.73863548264,4054.58495350393,3046.19572422862,2788.90595092878,2478.92486829118,2328.53345623715,2056.99482170422,1651.46901397141,1292.3018383762,636.413283371831,62.8644897706072,-468.549276542267,-891.613066530036,-905.322398088603],[-503.068862476114,-429.041489008175,-372.274254432531,-273.786410782708,-105.70222225177,270.993911145689,1085.3804208479,2234.78728933762,3109.78380362321,3658.41176981399,4054.58495350393,4781.43618290892,3448.72885256399,3029.82585649442,2653.2815019773,2485.57037619721,2291.58911961469,1892.56571949634,1580.35474044639,1062.5652491807,533.53039252943,-2.64325011500528,-513.498690861373,-648.206353654493],[-335.342799046346,-319.596948721869,-292.196363472307,-214.211028375725,-64.0283399925406,258.674067299379,852.074791454151,1647.13766664707,2255.37156123191,2676.14819149957,3046.19572422862,3448.72885256399,4206.8514285163,3206.76980669215,2722.53414215136,2473.85747773869,2327.66937508927,2069.40477059328,1828.15417880045,1385.05115181759,936.473425898978,459.569532335015,-89.149987346977,-331.657867363263],[-248.973469140394,-261.726759284937,-274.138646254527,-239.810803300072,-117.676869615405,194.514191496274,782.372932000561,1490.23840320001,2052.06966874198,2406.26462502793,2788.90595092878,3029.82585649442,3206.76980669215,4240.95219502757,3356.47935269689,2834.39753659332,2532.57396138984,2131.65511017594,1904.82034157081,1491.21719630396,1041.39340961943,589.820444171501,65.0691552249115,-139.755487791304],[-205.657290099726,-241.194859226093,-260.66386647577,-218.590074354257,-121.617694884786,188.662161479573,723.314629588567,1319.00427125767,1771.44752945008,2112.77877038649,2478.92486829118,2653.2815019773,2722.53414215136,3356.47935269689,4275.04202121613,3321.36390740046,2720.65546850891,2248.67983463895,2002.25789640526,1607.7948156602,1194.41432917989,732.279795467288,204.179856572079,-51.5544999810351],[-125.772108899024,-186.486108563557,-239.219537524325,-214.501852787873,-158.448389927914,120.188097788925,705.764051242458,1344.53555111919,1756.8602576815,2031.53384871444,2328.53345623715,2485.57037619721,2473.85747773869,2834.39753659332,3321.36390740046,4205.99824096687,3200.70313821416,2513.2942137329,2153.96100263439,1664.18848370096,1255.75236861644,792.002438822203,277.180372182176,41.4330445347593],[-61.5650061226059,-139.417559487269,-198.03249981036,-182.437915251042,-148.24035631006,29.9620282848025,504.168719951406,1129.59620144124,1530.84685377093,1744.37101436469,2056.99482170422,2291.58911961469,2327.66937508927,2532.57396138984,2720.65546850891,3200.70313821416,4050.02340061757,2997.61149808112,2490.1647435227,1989.94579089711,1541.83153394206,1010.06313069287,452.569318927148,136.0048600907],[-9.91346109897285,-100.45058928779,-173.337202122357,-197.929140119623,-210.55428388906,-85.6205235477422,197.615324297492,714.828922600904,1136.47246050357,1331.64486281168,1651.46901397141,1892.56571949634,2069.40477059328,2131.65511017594,2248.67983463895,2513.2942137329,2997.61149808112,3888.51016564222,2966.87043584068,2397.99714659582,1870.25911595089,1330.94378142409,651.880028176679,270.419224187905],[139.272229507424,-17.4656503199407,-126.191862075402,-168.586184012878,-230.174864960364,-231.481460797347,-103.130515554242,162.510958882952,518.307974950514,823.251845832587,1292.3018383762,1580.35474044639,1828.15417880045,1904.82034157081,2002.25789640526,2153.96100263439,2490.1647435227,2966.87043584068,4171.96285638971,3210.24627096767,2584.90437333661,1824.70475736873,1007.62135772449,523.427258331256],[384.43130011651,141.776208084321,-3.22369565213421,-60.8076009425842,-159.238474118646,-282.083136399519,-372.776523389267,-355.514226583812,-199.781863486271,125.553303833446,636.413283371831,1062.5652491807,1385.05115181759,1491.21719630396,1607.7948156602,1664.18848370096,1989.94579089711,2397.99714659582,3210.24627096767,4398.62809249678,3517.50501909992,2551.09359841835,1557.05571664676,908.161551668416],[578.359222671485,257.669452327802,100.163125378455,15.8674656704618,-136.742235045583,-365.270969596558,-553.622738266748,-669.039291716841,-640.254454637172,-400.207690796142,62.8644897706072,533.53039252943,936.473425898978,1041.39340961943,1194.41432917989,1255.75236861644,1541.83153394206,1870.25911595089,2584.90437333661,3517.50501909992,4451.14599051891,3348.05804651195,2108.56150490711,1249.17458011678],[834.15496101861,453.695062448052,261.382308859574,145.91201763484,-28.533540643028,-342.396480466606,-680.767379235463,-995.386356785675,-1056.21323757295,-867.340769931355,-468.549276542267,-2.64325011500528,459.569532335015,589.820444171501,732.279795467288,792.002438822203,1010.06313069287,1330.94378142409,1824.70475736873,2551.09359841835,3348.05804651195,4079.34198137252,2828.6622737821,1746.60528546549],[1135.21654088944,689.90141561801,470.756993396256,322.544762217753,171.258552926276,-155.798350673464,-606.031261985776,-1113.8843448676,-1277.00999606585,-1178.70105343522,-891.613066530036,-513.498690861373,-89.149987346977,65.0691552249115,204.179856572079,277.180372182176,452.569318927148,651.880028176679,1007.62135772449,1557.05571664676,2108.56150490711,2828.6622737821,3192.32054131272,2177.3597583329],[1244.55265597734,798.987160993346,586.608324137768,446.574179325641,342.721417978041,89.8401162195018,-342.425252171974,-835.76198968542,-1089.93245004748,-1109.66886402973,-905.322398088603,-648.206353654493,-331.657867363263,-139.755487791304,-51.5544999810351,41.4330445347593,136.0048600907,270.419224187905,523.427258331256,908.161551668416,1249.17458011678,1746.60528546549,2177.3597583329,2221.86612577239]],"type":"surface","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script> <strong>Sample correlation matrix</strong> is defined as</p>
<p><span class="math display">\[\widehat{Corr}(x(t), x(s)) = \frac{\widehat{Cov}(x(t), x(s))}{\sqrt{\widehat{Cov}(x(t))\widehat{Cov}(x(s))}}, \quad s,t = 1,\ldots, 24\]</span></p>
<pre class="r"><code>  ## plot the covariance surface
  hTAC.cor = cor(hTAC)
  plot_ly(z = ~hTAC.cor) %&gt;% add_surface()</code></pre>
<div id="htmlwidget-35c0202daf47c96056a2" style="width:768px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-35c0202daf47c96056a2">{"x":{"visdat":{"429f6ca3474a":["function () ","plotlyVisDat"]},"cur_data":"429f6ca3474a","attrs":{"429f6ca3474a":{"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"zaxis":{"title":"hTAC.cor"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"colorbar":{"title":"hTAC.cor","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"z":[[1,0.84925014414994,0.703122271829861,0.538226840316882,0.369663073597387,0.178840055345851,0.0207625261694748,-0.0982482117632626,-0.187845496762351,-0.238968643889102,-0.2360590406505,-0.210436407545353,-0.149548830564311,-0.110584435607508,-0.0909801269499188,-0.0560947766647337,-0.0279819376335188,-0.00459839538894348,0.0623687349143394,0.167661266378213,0.250746205460704,0.377767248716157,0.581163175109372,0.763707324150268],[0.84925014414994,1,0.872067888794,0.684723329368642,0.496702239128705,0.285919741959726,0.112701937720104,-0.0273110746894292,-0.128673246393636,-0.195397259158197,-0.222123237896313,-0.220319671606106,-0.174967426195892,-0.142708422497464,-0.130987851677604,-0.102104553245058,-0.0777896604990003,-0.0571997375021797,-0.00960169066983046,0.0759063137212755,0.137138748310224,0.252233148900791,0.433577718826975,0.601885696918185],[0.703122271829861,0.872067888794,1,0.804379269452105,0.593807577414418,0.365539265964394,0.184183191767366,0.0348453122974977,-0.0664867665354698,-0.144475631036134,-0.184932053490846,-0.205296711896383,-0.171788620533873,-0.160522808027068,-0.152022829638167,-0.140656652055232,-0.118660418683535,-0.105998162278616,-0.07450052018841,-0.00185350424339546,0.0572492921016311,0.156055581178094,0.317717917426342,0.474555980056553],[0.538226840316882,0.684723329368642,0.804379269452105,1,0.80252513751455,0.493172378339788,0.264476324988401,0.103836266054762,0.00801757899049609,-0.075721744230893,-0.125014453763578,-0.141948318840824,-0.118402476372479,-0.132018441683359,-0.11985545104897,-0.118575250618737,-0.102774147102897,-0.113793030975289,-0.0935727322272767,-0.0328697797801515,0.00852646855658068,0.0819018199150983,0.204660624210963,0.339650463569637],[0.369663073597387,0.496702239128705,0.593807577414418,0.80252513751455,1,0.727569114453013,0.444705500386539,0.252383789209939,0.136314837685531,0.0474578446799243,-0.00615184152026864,-0.0423459387236115,-0.0273464202654135,-0.050057164720468,-0.0515268273253979,-0.0676799634994159,-0.0645274514336961,-0.0935361071698825,-0.098717581995807,-0.0665114191232703,-0.0567771493100151,-0.012375633420422,0.0839664616826205,0.201413757141877],[0.178840055345851,0.285919741959726,0.365539265964394,0.493172378339788,0.727569114453013,1,0.730709789742317,0.47276910411209,0.308438729870333,0.197905885971608,0.140536904244445,0.0753906035108315,0.076720455622606,0.0574587895341162,0.0555074760955561,0.0356503491086051,0.00905689456879518,-0.0264133282480656,-0.0689418394222377,-0.0818192267403801,-0.10532127473363,-0.103126695827514,-0.0530452472849077,0.03666470794224],[0.0207625261694748,0.112701937720104,0.184183191767366,0.264476324988401,0.444705500386539,0.730709789742317,1,0.761233900315574,0.534486968526502,0.383420701626177,0.301039846357637,0.212496401750702,0.177847559048959,0.16264132633732,0.149763449409706,0.147324090688506,0.107249656589123,0.0429020237806878,-0.0216155231703119,-0.0760919495131201,-0.1123380235991,-0.144295390888638,-0.145208005662729,-0.0983457551798322],[-0.0982482117632626,-0.0273110746894292,0.0348453122974977,0.103836266054762,0.252383789209939,0.47276910411209,0.761233900315574,1,0.792499057143593,0.588620207596134,0.468517037795158,0.371090712128058,0.291591181386292,0.262752669089329,0.231632279925012,0.238045962930981,0.203806265427769,0.13162354116493,0.0288891996468663,-0.0615490617159425,-0.115143328232487,-0.178945054526577,-0.226365338678441,-0.203585454403008],[-0.187845496762351,-0.128673246393636,-0.0664867665354698,0.00801757899049609,0.136314837685531,0.308438729870333,0.534486968526502,0.792499057143593,1,0.795552383865688,0.641975651542717,0.517131606609801,0.399843075678276,0.36233516053667,0.3115359471715,0.311496192182842,0.276600554543208,0.209564330190389,0.0922715341270439,-0.0346375770384668,-0.110348581863255,-0.190154503566245,-0.259890926501204,-0.265883082856657],[-0.238968643889102,-0.195397259158197,-0.144475631036134,-0.075721744230893,0.0474578446799243,0.197905885971608,0.383420701626177,0.588620207596134,0.795552383865688,1,0.818087196061024,0.66359334772974,0.517511722261371,0.463447259024182,0.405296123933448,0.392896481344062,0.343794334293222,0.267846156441343,0.159864162393396,0.0237442329016148,-0.0752381539079864,-0.170326931984864,-0.261661029301672,-0.295272551251045],[-0.2360590406505,-0.222123237896313,-0.184932053490846,-0.125014453763578,-0.00615184152026864,0.140536904244445,0.301039846357637,0.468517037795158,0.641975651542717,0.818087196061024,1,0.800334506559178,0.641037648137651,0.584529588718658,0.517484671194227,0.490063388184611,0.441172823267156,0.361479047859669,0.273085137766825,0.130973952400271,0.0128609720711648,-0.100130073203846,-0.215390972752101,-0.262149262750842],[-0.210436407545353,-0.220319671606106,-0.205296711896383,-0.141948318840824,-0.0423459387236115,0.0753906035108315,0.212496401750702,0.371090712128058,0.517131606609801,0.66359334772974,0.800334506559178,1,0.768955630539831,0.672832245990088,0.586859248855285,0.554258470548858,0.520749430246714,0.438914742265926,0.353838581278019,0.231695609759892,0.115649580782785,-0.000598499815022429,-0.13143375409205,-0.198872694452628],[-0.149548830564311,-0.174967426195892,-0.171788620533873,-0.118402476372479,-0.0273464202654135,0.076720455622606,0.177847559048959,0.291591181386292,0.399843075678276,0.517511722261371,0.641037648137651,0.768955630539831,1,0.759202291210192,0.641984516110299,0.588114036896235,0.563915379502953,0.511652663595982,0.436379173757573,0.32197978328576,0.216411807041531,0.110937298082936,-0.0243270502603717,-0.108480773362698],[-0.110584435607508,-0.142708422497464,-0.160522808027068,-0.132018441683359,-0.050057164720468,0.0574587895341162,0.16264132633732,0.262752669089329,0.36233516053667,0.463447259024182,0.584529588718658,0.672832245990088,0.759202291210192,1,0.788282885214013,0.671111266911358,0.611085083235303,0.524920618398184,0.452847646647324,0.345263439702669,0.239688510789539,0.141805500137137,0.0176843960969785,-0.0455279649180885],[-0.0909801269499188,-0.130987851677604,-0.152022829638167,-0.11985545104897,-0.0515268273253979,0.0555074760955561,0.149763449409706,0.231632279925012,0.3115359471715,0.405296123933448,0.517484671194227,0.586859248855285,0.641984516110299,0.788282885214013,1,0.783270417820472,0.653844670181346,0.551525773022336,0.474110533721705,0.370767627680546,0.273809739196435,0.175352434661857,0.0552699986805184,-0.0167277466083245],[-0.0560947766647337,-0.102104553245058,-0.140656652055232,-0.118575250618737,-0.0676799634994159,0.0356503491086051,0.147324090688506,0.238045962930981,0.311496192182842,0.392896481344062,0.490063388184611,0.554258470548858,0.588114036896235,0.671111266911358,0.783270417820472,1,0.775500506928737,0.621465706692641,0.514201188600222,0.386909458896649,0.290224146913578,0.191203975627789,0.0756440344945528,0.0135535592770839],[-0.0279819376335188,-0.0777896604990003,-0.118660418683535,-0.102774147102897,-0.0645274514336961,0.00905689456879518,0.107249656589123,0.203806265427769,0.276600554543208,0.343794334293222,0.441172823267156,0.520749430246714,0.563915379502953,0.611085083235303,0.653844670181346,0.775500506928737,1,0.755361699715908,0.605799760226908,0.471469776606946,0.363138452172007,0.248499028441152,0.125864453938681,0.0453384551327268],[-0.00459839538894348,-0.0571997375021797,-0.105998162278616,-0.113793030975289,-0.0935361071698825,-0.0264133282480656,0.0429020237806878,0.13162354116493,0.209564330190389,0.267846156441343,0.361479047859669,0.438914742265926,0.511652663595982,0.524920618398184,0.551525773022336,0.621465706692641,0.755361699715908,1,0.736608532227199,0.579826981562715,0.449546107493783,0.334174290518443,0.185021760972029,0.0919998245799037],[0.0623687349143394,-0.00960169066983046,-0.07450052018841,-0.0935727322272767,-0.098717581995807,-0.0689418394222377,-0.0216155231703119,0.0288891996468663,0.0922715341270439,0.159864162393396,0.273085137766825,0.353838581278019,0.436379173757573,0.452847646647324,0.474110533721705,0.514201188600222,0.605799760226908,0.736608532227199,1,0.749392792427104,0.599844036251938,0.442310582636065,0.276104764852146,0.171920305803489],[0.167661266378213,0.0759063137212755,-0.00185350424339546,-0.0328697797801515,-0.0665114191232703,-0.0818192267403801,-0.0760919495131201,-0.0615490617159425,-0.0346375770384668,0.0237442329016148,0.130973952400271,0.231695609759892,0.32197978328576,0.345263439702669,0.370767627680546,0.386909458896649,0.471469776606946,0.579826981562715,0.749392792427104,1,0.794950679064419,0.602244321476301,0.415520337794643,0.290499604706103],[0.250746205460704,0.137138748310224,0.0572492921016311,0.00852646855658068,-0.0567771493100151,-0.10532127473363,-0.1123380235991,-0.115143328232487,-0.110348581863255,-0.0752381539079864,0.0128609720711648,0.115649580782785,0.216411807041531,0.239688510789539,0.273809739196435,0.290224146913578,0.363138452172007,0.449546107493783,0.599844036251938,0.794950679064419,1,0.785709496252731,0.559367343240225,0.397217409507304],[0.377767248716157,0.252233148900791,0.156055581178094,0.0819018199150983,-0.012375633420422,-0.103126695827514,-0.144295390888638,-0.178945054526577,-0.190154503566245,-0.170326931984864,-0.100130073203846,-0.000598499815022429,0.110937298082936,0.141805500137137,0.175352434661857,0.191203975627789,0.248499028441152,0.334174290518443,0.442310582636065,0.602244321476301,0.785709496252731,1,0.783849696685786,0.580150630723436],[0.581163175109372,0.433577718826975,0.317717917426342,0.204660624210963,0.0839664616826205,-0.0530452472849077,-0.145208005662729,-0.226365338678441,-0.259890926501204,-0.261661029301672,-0.215390972752101,-0.13143375409205,-0.0243270502603717,0.0176843960969785,0.0552699986805184,0.0756440344945528,0.125864453938681,0.185021760972029,0.276104764852146,0.415520337794643,0.559367343240225,0.783849696685786,1,0.817556925828472],[0.763707324150268,0.601885696918185,0.474555980056553,0.339650463569637,0.201413757141877,0.03666470794224,-0.0983457551798322,-0.203585454403008,-0.265883082856657,-0.295272551251045,-0.262149262750842,-0.198872694452628,-0.108480773362698,-0.0455279649180885,-0.0167277466083245,0.0135535592770839,0.0453384551327268,0.0919998245799037,0.171920305803489,0.290499604706103,0.397217409507304,0.580150630723436,0.817556925828472,1]],"type":"surface","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="intuition-behind-pca" class="section level2">
<h2>Intuition behind PCA</h2>
<div id="de-meaning" class="section level3">
<h3>De-meaning</h3>
<pre class="r"><code># create de-meaned diurnal profiles
hTAC.demean = hTAC - matrix(apply(hTAC, 2, mean), n, 24, byrow = TRUE)

## plot all profiles 
plot(x.range, hTAC.demean[1,], type = &quot;n&quot;, ylim = c(-300,300), xaxt = &quot;n&quot;, ylab = &quot;Log of Activity Counts&quot;, xlab = &quot;Hour&quot;, col = col.light, main = &quot;Diurnal Profiles&quot;)
for(i in 2:n) lines(1:24, hTAC.demean[i,], col = col.light, type = &quot;l&quot;, lwd = 1)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(h = 0, col = &quot;blue&quot;, lwd = 3)
lines(1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
lines(-1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_04-1.png" width="768" /></p>
</div>
<div id="principal-components" class="section level3">
<h3>Principal components</h3>
<p>Find “principal” patterns that explain largest proportions of <strong>total variation (= information)</strong>. Principal components = “principal” patterns (PC1 = red, PC2 = green, PC3 = blue) (1-2-3 = rgb)</p>
<pre class="r"><code>s = eigen(hTAC.cov, symmetric = T)
phi = s$vectors
col = c(&quot;red&quot;, &quot;green&quot;, &quot;blue&quot;)
plot(1:24, phi[,1], ylim = c(-0.4, 0.4), xaxt = &quot;n&quot;, xlab = &quot;Time of Day&quot;, ylab = &quot;AU&quot;, lwd = 3, col = col[1], type = &quot;l&quot;)
for (k in 2:3) lines(1:24, phi[,k], lwd = 3, col = col[k], type = &quot;l&quot;)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)
abline(h = 0, col = &quot;black&quot;, lty = &quot;dotted&quot;, lwd = 2)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_07-1.png" width="768" /></p>
</div>
<div id="pc1" class="section level3">
<h3>PC1</h3>
<p>PC1 explains 37.5% of total variation (note the local behaviour)</p>
<pre class="r"><code>
# create de-meaned diurnal profiles, calculate 1st PC and subtract its contribution
hTAC.demean.cov = cov(hTAC.demean)
s = eigen(hTAC.demean.cov, symmetric = T)
phi = s$vectors
PC1 = phi[,1]
PC1.score = as.matrix(hTAC.demean) %*% phi[,1]
hTAC.PC1 &lt;- PC1.score %*% phi[,1]
hTAC.demean.minus.PC1 = hTAC.demean - hTAC.PC1


## plot all profiles 
plot(x.range, hTAC.PC1[1,], type = &quot;n&quot;, ylim = c(-300,300), xaxt = &quot;n&quot;, ylab = &quot;Log of Activity Counts&quot;, xlab = &quot;Hour&quot;, col = col.light, main = &quot;Diurnal Profiles&quot;)
for(i in 2:n) lines(1:24, hTAC.PC1[i,], col = col.light, type = &quot;l&quot;, lwd = 1)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))

abline(h = 0, col = &quot;blue&quot;, lwd = 3)
lines(1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
lines(-1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_08-1.png" width="768" /></p>
</div>
<div id="pc2" class="section level3">
<h3>PC2</h3>
<p>PC2 explains 22.5% of total variation (but note the local behaviour)</p>
<pre class="r"><code># create de-meaned diurnal profiles, calculate 1st PC and subtract its contribution
hTAC.demean.cov = cov(hTAC.demean)
s = eigen(hTAC.demean.cov, symmetric = T)
phi = s$vectors
PC2 = phi[,2]
PC2.score = as.matrix(hTAC.demean) %*% PC2
hTAC.PC2 &lt;- PC2.score %*% PC2
hTAC.demean.minus.PC2 = hTAC.demean - hTAC.PC2


## plot all profiles 
plot(x.range, hTAC.PC2[1,], type = &quot;n&quot;, ylim = c(-300,300), xaxt = &quot;n&quot;, ylab = &quot;Log of Activity Counts&quot;, xlab = &quot;Hour&quot;, col = col.light, main = &quot;Diurnal Profiles&quot;)
for(i in 2:n) lines(1:24, hTAC.PC2[i,], col = col.light, type = &quot;l&quot;, lwd = 1)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(h = 0, col = &quot;blue&quot;, lwd = 3)
lines(1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
lines(-1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_09-1.png" width="768" /></p>
</div>
<div id="pc3" class="section level3">
<h3>PC3</h3>
<p>PC3 explains 10.7% of total variation (but note the local behaviour)</p>
<pre class="r"><code># create de-meaned diurnal profiles, calculate 1st PC and subtract its contribution
PC3 = phi[,3]
PC3.score = as.matrix(hTAC.demean) %*% PC3
hTAC.PC3 &lt;- PC3.score %*% PC3
hTAC.demean.minus.PC3 = hTAC.demean - hTAC.PC3

## plot all profiles 
plot(x.range, hTAC.PC3[1,], type = &quot;n&quot;, ylim = c(-300,300), xaxt = &quot;n&quot;, ylab = &quot;Log of Activity Counts&quot;, xlab = &quot;Hour&quot;, col = col.light, main = &quot;Diurnal Profiles&quot;)
for(i in 2:n) lines(1:24, hTAC.PC3[i,], col = col.light, type = &quot;l&quot;, lwd = 1)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(h = 0, col = &quot;blue&quot;, lwd = 3)
lines(1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
lines(-1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_10-1.png" width="768" /></p>
</div>
</div>
<div id="residual-variability" class="section level2">
<h2>Residual variability</h2>
<p>De-meaned diurnal profiles</p>
<pre class="r"><code>plot(x.range, hTAC.demean[1,], type = &quot;n&quot;, ylim = c(-300,300), xaxt = &quot;n&quot;, ylab = &quot;Log of Activity Counts&quot;, xlab = &quot;Hour&quot;, col = col.light, main = &quot;Diurnal Profiles&quot;)
for(i in 2:n) lines(1:24, hTAC.demean[i,], col = col.light, type = &quot;l&quot;, lwd = 1)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(h = 0, col = &quot;blue&quot;, lwd = 3)
lines(1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
lines(-1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_11-1.png" width="768" /></p>
<p>Subtract PC1 that explains 37.5% of total variation</p>
<pre class="r"><code>PC1.score = as.matrix(hTAC.demean) %*% PC1
hTAC.PC1 &lt;- PC1.score %*% PC1
hTAC.demean.minus.PC1 = hTAC.demean - hTAC.PC1


## plot all profiles 
plot(x.range, hTAC.demean.minus.PC1[1,], type = &quot;n&quot;, ylim = c(-300,300), xaxt = &quot;n&quot;, ylab = &quot;Log of Activity Counts&quot;, xlab = &quot;Hour&quot;, col = col.light, main = &quot;Diurnal Profiles&quot;)
for(i in 2:n) lines(1:24, hTAC.demean.minus.PC1[i,], col = col.light, type = &quot;l&quot;, lwd = 1)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(h = 0, col = &quot;blue&quot;, lwd = 3)
lines(1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
lines(-1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_12-1.png" width="768" /></p>
<p>Subtract PC1 and PC2 that explain 60% of total variation</p>
<pre class="r"><code>s = eigen(hTAC.demean.cov, symmetric = T)
phi = s$vectors

## PC1
PC1 = phi[,1]
PC1.score = as.matrix(hTAC.demean) %*% PC1
hTAC.PC1 &lt;- PC1.score %*% PC1

## PC2
PC2 = phi[,2]
PC2.score = as.matrix(hTAC.demean) %*% PC2
hTAC.PC2 &lt;- PC2.score %*% PC2
hTAC.demean.minus.PC12 = hTAC.demean - hTAC.PC1 - hTAC.PC2

## plot all profiles 
plot(x.range, hTAC.demean.minus.PC12[1,], type = &quot;n&quot;, ylim = c(-300,300), xaxt = &quot;n&quot;, ylab = &quot;Log of Activity Counts&quot;, xlab = &quot;Hour&quot;, col = col.light, main = &quot;Diurnal Profiles&quot;)
for(i in 2:n) lines(1:24, hTAC.demean.minus.PC12[i,], col = col.light, type = &quot;l&quot;, lwd = 1)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(h = 0, col = &quot;blue&quot;, lwd = 3)
lines(1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
lines(-1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_13-1.png" width="768" /> Subtract PC1, PC2, and PC3 that explain 70.8% of total variation</p>
<pre class="r"><code>hTAC.demean.cov = cov(hTAC.demean)
s = eigen(hTAC.demean.cov, symmetric = T)
phi = s$vectors

## PC1
PC1 = phi[,1]
PC1.score = as.matrix(hTAC.demean) %*% PC1
hTAC.PC1 &lt;- PC1.score %*% PC1

## PC2
PC2 = phi[,2]
PC2.score = as.matrix(hTAC.demean) %*% PC2
hTAC.PC2 &lt;- PC2.score %*% PC2

## PC3
PC3 = phi[,3]
PC3.score = as.matrix(hTAC.demean) %*% PC3
hTAC.PC3 &lt;- PC3.score %*% PC3
hTAC.demean.minus.PC123 = hTAC.demean - hTAC.PC1 - hTAC.PC2 - hTAC.PC3

## plot all profiles 
plot(x.range, hTAC.demean.minus.PC123[1,], type = &quot;n&quot;, ylim = c(-300,300), xaxt = &quot;n&quot;, ylab = &quot;Log of Activity Counts&quot;, xlab = &quot;Hour&quot;, col = col.light, main = &quot;Diurnal Profiles&quot;)
for(i in 2:n) lines(1:24, hTAC.demean.minus.PC123[i,], col = col.light, type = &quot;l&quot;, lwd = 1)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(h = 0, col = &quot;blue&quot;, lwd = 3)
lines(1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
lines(-1.96*hTAC.sd, col = &quot;blue&quot;, lwd = 3, type = &quot;l&quot;, lty = &quot;dashed&quot;)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_14-1.png" width="768" /> ### <strong>Scree-plot</strong></p>
<pre class="r"><code>s = eigen(hTAC.cov, symmetric = T)
lambda = s$values
plot(1:24, 100*lambda/sum(lambda), xlab = &quot;PC&quot;, ylab = &quot;% of total variation explained&quot;, lwd = 4, col = &quot;blue&quot;)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)
abline(h = (1:10)*10, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_05-1.png" width="768" /></p>
<pre class="r"><code>plot(1:24, 100*cumsum(lambda)/sum(lambda), xlab = &quot;PC&quot;, ylab = &quot;cumulative % of total variation explained&quot;,lwd = 4, col = &quot;blue&quot;)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)
abline(h = (1:10)*10, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_06-1.png" width="768" /></p>
</div>
<div id="functional-pca" class="section level2">
<h2>Functional PCA</h2>
<p>Classical PCA does not use smoothness. Functional PCA smooths the sample covariance matrix and then finds corresponding PCs. R package “refund” performs functional PCA.</p>
<pre class="r"><code>s = fpca.sc(hTAC, var = TRUE, npc = 6)
x.mean = s$mu
phi.fpca = s$efunctions
lambda.fpca = s$evalues
sigma.fpca = s$sigma2</code></pre>
<p>Let us compare PC1 (blue dots) and fPC1 (red curve)</p>
<pre class="r"><code># create de-meaned diurnal profiles, calculate 1st PC and subtract its contribution
s.svd = eigen(hTAC.demean.cov, symmetric = T)
phi.svd = s.svd$vectors

## plotting smooth vs non-smooth PCs
plot(x.range, phi.svd[,1],  ylim = c(-0.4, 0.4), xaxt = &quot;n&quot;, ylab = &quot;AU&quot;, xlab = &quot;Hour&quot;, col = &quot;blue&quot;, main = &quot;Compare PCs vs fPCs&quot;)
lines(1:24, phi.fpca[,1]/sqrt(sum(phi.fpca[,1]^2)), col = &quot;red&quot;, type = &quot;l&quot;, lwd = 1, lty = &quot;dashed&quot;)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(h = 0, col = &quot;gray&quot;, lwd = 2)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_16-1.png" width="768" /></p>
<p>Let us compare PC2 (blue dots) vs fPC2 (red curve)</p>
<blockquote>
<p>Main reasons for not seeing larger differences: pre-smoothing (binning in hour epochs), smaller samples likely results in larger deviations.</p>
</blockquote>
<pre class="r"><code># create de-meaned diurnal profiles, calculate 1st PC and subtract its contribution
s.svd = eigen(hTAC.demean.cov, symmetric = T)
phi.svd = s.svd$vectors

## plotting smooth vs non-smooth PCs
plot(x.range, phi.svd[,2],  ylim = c(-0.4, 0.4), xaxt = &quot;n&quot;, ylab = &quot;AU&quot;, xlab = &quot;Hour&quot;, col = &quot;blue&quot;, main = &quot;Compare PCs vs fPCs&quot;)
lines(1:24, phi.fpca[,2]/sqrt(sum(phi.fpca[,2]^2)), col = &quot;red&quot;, type = &quot;l&quot;, lwd = 1, lty = &quot;dashed&quot;)
axis(1, at = c(1, 4, 8, 12, 16, 20, 24), labels = c(&quot;01:00&quot;, &quot;04:00&quot;, &quot;08:00&quot;, &quot;12:00&quot;, &quot;16:00&quot;, &quot;20:00&quot;, &quot;24:00&quot;))
abline(h = 0, col = &quot;gray&quot;, lwd = 2)
abline(v = 1:24, col = &quot;gray&quot;, lty = &quot;dotted&quot;)</code></pre>
<p><img src="shortcourse_fpca_files/figure-html/nhanes_all_subjects_17-1.png" width="768" /></p>
<div id="technical-details" class="section level3">
<h3>Technical details</h3>
<p>fPCA wants to find a sequence of orthonormal functions <span class="math inline">\(\phi_1(t),\ldots, \phi_K(t)\)</span> that sequentially explains most of <strong>total variation = total information</strong></p>
<p><strong>Step 1:</strong> Find <span class="math inline">\(\phi_1(t)\)</span> that maximizes <span class="math inline">\(\sum_{i=1}^n \xi^2_{i1}\)</span>, where</p>
<p>scores/projections <span class="math inline">\(\xi_{i1} = &lt;x_i, \phi_1&gt; = \int_1^{24} x_i(t)\phi_1(t) dt \quad \mbox{and}\quad \int_1^{24} \phi^2_1(t) dt = 1\)</span> keep the information.</p>
<p><strong>Step k:</strong> Find <span class="math inline">\(\phi_k(t)\)</span> that maximizes <span class="math inline">\(\sum_{i=1}^n \xi^2_{ik}\)</span> and <span class="math inline">\(&lt;\phi_k,\phi_s&gt; = 0, s &lt; k\)</span></p>
<p>scores <span class="math inline">\(\xi_{ik} = &lt;x_i, \phi_k&gt; = \int_1^{24} x_i(t)\phi_k(t) dt\quad \mbox{and} \quad \int_1^{24} \phi^2_k(t) dt = 1\)</span></p>
<p>Thus, each observed diurnal pattern is substituted with its fPCA approximation <span class="math display">\[x_i(t) \approx \mu(t) + \phi_1(t)\xi_{i1}+\phi_2(t)\xi_{i2}+\phi_3(t)\xi_{i3} \]</span> <span class="math display">\[\phi_1(t),\phi_2(t), \phi_3(t)\]</span> are <strong>principal functions</strong> (data-driven population-level basis) + <span class="math inline">\(\xi_{i1},\xi_{i2},\xi_{i3}\)</span> are <strong>principal scores</strong> (subject-specific coordinates)</p>
</div>
<div id="dimension-reduction-via-fpca" class="section level3">
<h3>Dimension-reduction via fPCA</h3>
<p>Instead of dealing with <strong>24 correlated numbers</strong> <span class="math inline">\((x_i(1), x_i(2),\ldots, x_i(24))\)</span>, we can now focus only on <strong>3 uncorrelated scores</strong> <span class="math inline">\(\xi_{i1}, \xi_{i2}, \xi_{i3}\)</span> that are ordered in terms of the amount of preserved information and combined preserve roughly 70% of total variation.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
